

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Equilibrium with some concentrations fixed &mdash; EQTK 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/togglebutton.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Volumetric titration" href="eqtk_volumetric_titration.html" />
    <link rel="prev" title="Generic equilibrium solver" href="eqtk_solve.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #827F7F" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/eqtk_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/quickstart.html">Quick start</a></li>
</ul>
<p class="caption"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../core_concepts.html">Core concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">Conventions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">High-level interfaces</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="eqtk_solve.html">Solve</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Solve with some concentrations fixed</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-problem">Example problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-chemical-reactions">The chemical reactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initial-and-fixed-concentrations">Initial and fixed concentrations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solving-for-the-relative-abundance">Solving for the relative abundance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#over-constraining-a-problem">Over-constraining a problem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="eqtk_volumetric_titration.html">Volumetric titration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../parsers_and_utilities/index.html">Parsers and utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../low_level_interface.html">EQTK low level interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Case studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../case_studies/ligand_receptor.html">Promiscuous ligand-receptor binding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../case_studies/hcr.html">Hyrbidization chain reaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../case_studies/competition_anisotropy.html">Competition anisotropy</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EQTK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
<li><a href="https://github.com/justinbois/eqtk">EQTK repo on GitHub</a></li>

    
  <li class="wy-breadcrumbs-aside">
    
        
        
            <a href="../../_sources/user_guide/high_level/eqtk_fixed_value_solve.rst.txt" rel="nofollow"> View page source</a>
        
      
    
  </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="equilibrium-with-some-concentrations-fixed">
<span id="eqtk-fixed-value-solve"></span><h1>Equilibrium with some concentrations fixed<a class="headerlink" href="#equilibrium-with-some-concentrations-fixed" title="Permalink to this headline">¶</a></h1>
<p>Sometimes we may have a chemical system in which one or more species has their concentration held constant. For example, we could have a system where a chemical species is constantly fed in such that its concentration in the reaction vessel remains constant. As another example, we might have a weak acid in solution and we add a strong acid to control the pH, thereby keeping the concentration of hydrogen ions constant.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">eqtk.final_value_solve()</span></code> function allows for solving the coupled equilibrium problem when one or more of of chemical species are present in fixed amounts. Its API, as we will demonstrate, is the same as <code class="docutils literal notranslate"><span class="pre">eqtk.solve()</span></code>, except an additional input, <code class="docutils literal notranslate"><span class="pre">fixed_c</span></code>, which specifies the fixed concentration is required. However, <code class="docutils literal notranslate"><span class="pre">eqtk.final_value_solve()</span></code> only accepts input of the stoichiometric matrix and equilibrium constants; input of free energies and a conservation matrix are not yet implemented.</p>
<p>In what follows, we will assume that Numpy, Pandas, and EQTK have been imported respectively as <code class="docutils literal notranslate"><span class="pre">np</span></code>, <code class="docutils literal notranslate"><span class="pre">pd</span></code>, and <code class="docutils literal notranslate"><span class="pre">eqtk</span></code>.</p>
<div class="section" id="example-problem">
<h2>Example problem<a class="headerlink" href="#example-problem" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate the use of <code class="docutils literal notranslate"><span class="pre">eqtk.fixed_value_solve()</span></code>, we will consider the protonation state of <a class="reference external" href="https://en.wikipedia.org/wiki/Aspartic_acid">aspartic acid</a>. The reactions describing deprotonation are</p>
<p>H₃D⁺ ⇌ H₂D + H⁺</p>
<p>H₂D ⇌ HD⁻ + H⁺</p>
<p>HD⁻ ⇌ D²⁻ + H⁺</p>
<p>The respective pKₐ’s for the reaction are 1.99, 3.9, and 10.002. We additionally need to take into account the dissociation of water,</p>
<p>H₂O ⇌ OH⁻ + H⁺,</p>
<p>which has an equilibrium constant of 10⁻¹⁴ M².</p>
<p>Our goal is to compute the relative abundances of the four protonation states of aspartic acid as a function of pH. Thus, for each pH value, we want to fix [H⁺] = 10⁻ᵖᴴ and compute the equilibrium concentrations of the other species.</p>
</div>
<div class="section" id="the-chemical-reactions">
<h2>The chemical reactions<a class="headerlink" href="#the-chemical-reactions" title="Permalink to this headline">¶</a></h2>
<p>We can conveniently specify the chemical reactions and species using EQTK’s parser for string representations. Recall that solvent is <strong>not</strong> explicitly included in the chemical reactions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rxns</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">     &lt;=&gt; OH⁻ + H⁺  ; 1e-14</span>
<span class="s2">H₃D⁺ &lt;=&gt; H₂D + H⁺  ; </span><span class="si">{Ka1}</span><span class="s2"></span>
<span class="s2">H₂D  &lt;=&gt; HD⁻ + H⁺  ; </span><span class="si">{Ka2}</span><span class="s2"></span>
<span class="s2">HD⁻  &lt;=&gt; D²⁻ + H⁺  ; </span><span class="si">{Ka3}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Ka1</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.99</span><span class="p">),</span> <span class="n">Ka2</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">3.9</span><span class="p">),</span> <span class="n">Ka3</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">10.002</span><span class="p">))</span>

<span class="n">N</span> <span class="o">=</span> <span class="n">eqtk</span><span class="o">.</span><span class="n">parse_rxns</span><span class="p">(</span><span class="n">rxns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="initial-and-fixed-concentrations">
<h2>Initial and fixed concentrations<a class="headerlink" href="#initial-and-fixed-concentrations" title="Permalink to this headline">¶</a></h2>
<p>The initial concentrations of all species, $mathbf{c}^0$, is specified the same as for <code class="docutils literal notranslate"><span class="pre">eqtk.solve()</span></code>. For this calculation, we will begin with 1 mM H₂D.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c0</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;H⁺&quot;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;OH⁻&quot;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;H₃D⁺&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;H₂D&quot;</span><span class="p">:</span>  <span class="mf">0.001</span><span class="p">,</span>
    <span class="s2">&quot;HD⁻&quot;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;D²⁻&quot;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>While it is convenient to specify the concentrations of the species as a dictionary, we could also use a Pandas Series or DataFrame. (We could also specify <code class="docutils literal notranslate"><span class="pre">N</span></code>, <code class="docutils literal notranslate"><span class="pre">K</span></code>, and <code class="docutils literal notranslate"><span class="pre">c0</span></code> as Numpy arrays.) The specification of inputs is the same as for <code class="docutils literal notranslate"><span class="pre">eqtk.solve()</span></code>.</p>
<p>We need to further specify the fixed concentrations. We will consider pH ranging from zero to 14, with 400 points in between. To set up the fixed concentrations, we create a DataFrame with six columns, one for each species, with 400 rows, one for each pH value we want to consider. Entries in the data frame that are either negative or <cite>np.nan</cite> denote concentrations that are <strong>not</strong> fixed. So, we initialize the data frame with negative ones. Following that, we fill the column for H⁺ with our desired fixed values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fixed_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="n">c0</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">pH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">fixed_c</span><span class="p">[</span><span class="s2">&quot;H⁺&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pH</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">fixed_c</span></code> DataFrame has the following first five rows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>         H⁺  OH⁻  H₃D⁺  H₂D  HD⁻  D²⁻
0  0.100000 -1.0  -1.0 -1.0 -1.0 -1.0
1  0.082386 -1.0  -1.0 -1.0 -1.0 -1.0
2  0.066777 -1.0  -1.0 -1.0 -1.0 -1.0
3  0.053177 -1.0  -1.0 -1.0 -1.0 -1.0
4  0.041543 -1.0  -1.0 -1.0 -1.0 -1.0
</pre></div>
</div>
</div>
<div class="section" id="solving-for-the-relative-abundance">
<h2>Solving for the relative abundance<a class="headerlink" href="#solving-for-the-relative-abundance" title="Permalink to this headline">¶</a></h2>
<p>We call <code class="docutils literal notranslate"><span class="pre">eqtk.fixed_value_solve()</span></code> similarly to <code class="docutils literal notranslate"><span class="pre">eqtk.solve()</span></code>, except with the additional argument <code class="docutils literal notranslate"><span class="pre">fixed_c</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">eqtk</span><span class="o">.</span><span class="n">fixed_value_solve</span><span class="p">(</span><span class="n">c0</span><span class="o">=</span><span class="n">c0</span><span class="p">,</span> <span class="n">fixed_c</span><span class="o">=</span><span class="n">fixed_c</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Because we supplied our inputs as data frames, the output is also a data frame. The output is as for <code class="docutils literal notranslate"><span class="pre">eqtk.solve()</span></code>, except there are additional columns with names like <code class="docutils literal notranslate"><span class="pre">'[H⁺]__fixed</span> <span class="pre">(M)'</span></code>, denoting concentrations that were fixed in the calculation.</p>
<p>A plot of the relative abundances computed from <code class="docutils literal notranslate"><span class="pre">c</span></code> is shown below.</p>

<script src="bokeh-plot-e98b4a689f554e0897f3fa7e978827bf-external-user_guide-high_level-eqtk_fixed_value_solve.js" id="fd0f2f56-b4d7-4676-9fc4-aa609653c679"></script></div>
<div class="section" id="over-constraining-a-problem">
<h2>Over-constraining a problem<a class="headerlink" href="#over-constraining-a-problem" title="Permalink to this headline">¶</a></h2>
<p>In a given calculation, only some species may have fixed concentration, lest the coupled equilibrium problem be over-constrained. EQTK will check for this and raise an exception if the problem becomes over-constrained. For example, we cannot fix both the H⁺ and OH⁻ concentrations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fixed_c</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;H⁺&quot;</span><span class="p">:</span>   <span class="mf">0.01</span><span class="p">,</span>
    <span class="s2">&quot;OH⁻&quot;</span><span class="p">:</span>  <span class="mf">0.0001</span><span class="p">,</span>
    <span class="s2">&quot;H₃D⁺&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;H₂D&quot;</span><span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;HD⁻&quot;</span><span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;D²⁻&quot;</span><span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">eqtk</span><span class="o">.</span><span class="n">fixed_value_solve</span><span class="p">(</span><span class="n">c0</span><span class="o">=</span><span class="n">c0</span><span class="p">,</span> <span class="n">fixed_c</span><span class="o">=</span><span class="n">fixed_c</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This results in a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> saying that the stoichiometric matrix is rank deficient.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="eqtk_volumetric_titration.html" class="btn btn-neutral float-right" title="Volumetric titration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="eqtk_solve.html" class="btn btn-neutral float-left" title="Generic equilibrium solver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> <jinja2.runtime.BlockReference object at 0x6282db490> 

<p>© 2020 Justin Bois.</p>

<p>This document was prepared at <a rel="caltech" href="http://www.caltech.edu">Caltech</a> with financial support from the <a rel="rosen" href="http://rosen.caltech.edu">Donna and Benjamin M. Rosen Bioengineering Center</a>.</p>

<br />

<p>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>.

 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-166791717-1', 'auto');
    ga('send', 'pageview');
    </script>

    
    

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>